<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UCAT VR Practice - MedwithPurpose</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        /* Custom styles for better UI/UX */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden; /* Prevent scrolling on body */
            font-family: 'Inter', sans-serif;
        }

        /* --- REDESIGNED THEMES --- */
        .theme-background {
            background-color: #f0f2f5;
        }

        #setup-screen, #results-screen {
            background: linear-gradient(170deg, #c7d2fe 0%, #f0f2f5 50%, #b0bec5 100%);
        }

        .card {
            background-color: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1);
            border-radius: 1rem;
        }

        .primary-button-new {
            background-image: linear-gradient(135deg, #4f46e5, #6366f1);
            color: white;
            border: none;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(79, 70, 229, 0.3);
            font-weight: 600;
            padding: 0.75rem 2rem;
            border-radius: 0.5rem;
        }
        .primary-button-new:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(79, 70, 229, 0.4);
            background-image: linear-gradient(135deg, #4338ca, #4f46e5);
        }

        .secondary-button-new {
            background-color: transparent;
            color: #4353ff;
            border: 1px solid #4353ff;
            transition: all 0.3s ease;
             font-weight: 600;
            padding: 0.75rem 2rem;
            border-radius: 0.5rem;
        }
        .secondary-button-new:hover {
            background-color: rgba(67, 83, 255, 0.1);
            transform: translateY(-2px);
        }

        input.themed-input {
            background-color: #f0f2f5;
            border: 1px solid #d1d5db;
            color: #1f2937;
        }
        input.themed-input:focus {
            border-color: #4353ff;
            box-shadow: 0 0 0 2px rgba(67, 83, 255, 0.2);
            outline: none;
        }

        /* --- Original Test Environment Styles --- */
        #app-container {
            display: flex;
            flex-direction: column;
            height: calc(100vh - 2rem);
            width: 100%;
            background-color: #ffffff;
            border: 1px solid #d1d5db;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            border-radius: 0.375rem;
            margin: 1rem;
            overflow: hidden;
        }
        .header-bar, .footer-bar {
            flex-shrink: 0;
            background-color: #006DAA;
            color: white;
            padding: 0.75rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-bar span, .header-bar div { color: white; }
        #timer { background-color: rgba(255, 255, 255, 0.2); color: white; font-weight: bold; padding: 0.25rem 0.75rem; border-radius: 0.25rem; }
        .footer-bar button, .font-size-button { background-color: transparent; color: white; border: 1px solid rgba(255, 255, 255, 0.5); padding: 0.4rem 0.8rem; font-size: 0.8rem; border-radius: 0.375rem; transition: background-color 0.2s ease, border-color 0.2s ease; }
        .font-size-button { padding: 0.2rem 0.6rem; font-weight: bold; line-height: 1.25; }
        .footer-bar button:hover:not(:disabled), .font-size-button:hover:not(:disabled) { background-color: rgba(255, 255, 255, 0.15); border-color: white; }
        .footer-bar button:disabled { opacity: 0.5; cursor: not-allowed; border-color: rgba(255, 255, 255, 0.3); }
        .footer-bar button#next-button { background-color: #ffffff; color: #006DAA; border: 1px solid white; font-weight: 500; }
        .footer-bar button#next-button:hover:not(:disabled) { background-color: #f0f0f0; }
        #flag-button { background-color: transparent; border: 1px solid white; color: white; transition: background-color 0.2s ease, color 0.2s ease; }
        #flag-button:hover { background-color: white; color: #006DAA; }
        #flag-button.flagged { background-color: #facc15; border-color: #facc15; color: #422006; }
        #flag-button.flagged:hover { background-color: #f59e0b; border-color: #f59e0b; }

        .main-content-area { flex-grow: 1; display: flex; overflow: hidden; padding: 1rem; gap: 1rem; }
        
        /* UPDATED: Column widths changed to 60/40 split */
        .passage-column {
            flex: 0 0 60%;
            overflow-y: auto; padding: 1rem; border: 1px solid #e5e7eb; border-radius: 0.375rem; background-color: #ffffff; height: 100%; transition: font-size 0.2s ease;
        }
        .question-column {
            flex: 0 0 40%;
            overflow-y: auto; padding: 1rem; border: 1px solid #e5e7eb; border-radius: 0.375rem; background-color: #ffffff; height: 100%; transition: font-size 0.2s ease;
            position: relative;
        }

        .selected-answer { background-color: #bfdbfe !important; border-color: #3b82f6 !important; }
        .nav-answered { background-color: #a7f3d0; }
        .nav-current { border: 2px solid #3b82f6 !important; font-weight: bold; }
        .nav-flagged, .review-flagged { border: 2px solid #f59e0b !important; position: relative; }
        .modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6); align-items: center; justify-content: center; }
        .modal-content { background-color: #fefefe; margin: auto; padding: 20px; border: 1px solid #888; width: 80%; max-width: 600px; border-radius: 0.5rem; }
        .modal.flex { display: flex; }

        .option-label { display: block; padding: 0.75rem 1rem; border: 1px solid #d1d5db; border-radius: 0.375rem; margin-bottom: 0.5rem; cursor: pointer; transition: background-color 0.2s ease, border-color 0.2s ease; background-color: #ffffff; color: #111827; }
        .option-label:hover:not(.selected-answer) { background-color: #f3f4f6; border-color: #a5b4fc; }
        input[type="radio"] { display: none; }
        .resizable-text { font-size: 1rem; }

        .explanation-box { background-color: #f3f4f6; border: 1px solid #d1d5db; padding: 0.5rem 0.75rem; margin-top: 0.75rem; border-radius: 0.375rem; color: #111827; }

        .review-grid-button { padding: 0.5rem 0.25rem; border: 1px solid #d1d5db; border-radius: 0.375rem; text-align: center; transition: background-color 0.2s ease, border-color 0.2s ease; font-size: 0.875rem; line-height: 1.25rem; cursor: pointer; }
        .review-grid-button-answered { background-color: #dcfce7; border-color: #86efac; color: #15803d; }
        .review-grid-button-unanswered { background-color: #f3f4f6; border-color: #d1d5db; color: #4b5563; }
        .review-grid-button:hover { filter: brightness(95%); }

        /* Results Screen Grid */
        #results-grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(60px, 1fr)); gap: 0.75rem; padding: 1rem 0; width: 100%; }
        .result-box { display: flex; flex-direction: column; align-items: center; justify-content: center; aspect-ratio: 1 / 1; padding: 0.25rem; border-radius: 0.5rem; color: white; text-align: center; cursor: pointer; transition: transform 0.2s ease, box-shadow 0.2s ease; box-shadow: 0 2px 4px rgba(0,0,0,0.1); width: 100%; height: auto; border: none; }
        .result-box:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
        
        .result-box-correct {
            background: linear-gradient(145deg, #22c55e, #15803d);
        }
        .result-box-incorrect {
            background: linear-gradient(145deg, #ef4444, #b91c1c);
        }
        .result-box-flagged { outline: 3px solid #f59e0b; outline-offset: 2px; }
        .result-box .time-spent { font-size: 1rem; font-weight: 600; line-height: 1.1; }
        .question-num-label { font-size: 0.75rem; color: #4b5563; text-align: center; width: 100%; margin-top: 0.25rem; }

        @media (max-width: 768px) {
            #app-container { height: auto; margin: 0.5rem; }
            .main-content-area { flex-direction: column; padding: 0.5rem; gap: 0.5rem; }
            .passage-column, .question-column { flex-basis: auto; width: 100%; } /* Reverts to block-level stacking on mobile */
            .header-bar, .footer-bar { padding: 0.5rem 1rem; }
            .header-bar span, .footer-bar button, .font-size-button { font-size: 0.8rem; }
            #review-grid { grid-template-columns: repeat(5, minmax(0, 1fr)); }
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    </head>
<body class="theme-background">

    <div id="app-container" class="!border-none !shadow-none !m-0 !rounded-none">

        <div id="setup-screen" class="p-4 md:p-8 flex flex-col justify-center items-center h-full w-full">
            <div class="w-full max-w-lg text-center">
                <img src="https://ik.imagekit.io/mwp/MWP%20Color%20no%20background.png?updatedAt=1745982959141"
                     alt="MedwithPurpose Logo"
                     class="mx-auto h-24 w-auto mb-6"
                     onerror="this.style.display='none'; this.onerror=null;">
                <div class="card p-8 md:p-10">
                    <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-2">Verbal Reasoning Practice</h1>
                    <p class="text-gray-600 mt-2 text-lg mb-8">Sharpen your skills for the UCAT VR section.</p>
                    <div class="text-left space-y-3 mb-8 bg-blue-50/50 border border-blue-200/50 rounded-lg p-4">
                        <p class="text-sm text-gray-800"><strong class="font-semibold">Questions:</strong> <span id="setup-question-count">16</span></p>
                        <p class="text-sm text-gray-800"><strong class="font-semibold">Time Limit:</strong> <span id="setup-time-limit">9 minutes</span></p>
                    </div>

                    <div class="space-y-6 text-left">
                        <div>
                            <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                            <input type="text" id="name" name="name" class="themed-input mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" placeholder="Enter your name">
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="goal" class="block text-sm font-medium text-gray-700 mb-1">Score Goal</label>
                                <input type="number" id="goal" name="goal" min="0" max="16" class="themed-input mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none sm:text-sm" placeholder="e.g., 12">
                            </div>
                            <div>
                                <label for="focus-area" class="block text-sm font-medium text-gray-700 mb-1">Practice Intention</label>
                                <input type="text" id="focus-area" name="focus-area" class="themed-input mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none sm:text-sm" placeholder="e.g., Speed, Accuracy">
                            </div>
                        </div>
                    </div>

                    <div class="mt-10">
                        <button id="start-button" class="primary-button-new w-full text-lg">
                            Start Exam
                        </button>
                    </div>
                </div>
            </div>
        </div>


        <div id="exam-screen" class="hidden flex flex-col h-full">
            <div class="header-bar">
                <span id="exam-title" class="font-semibold">Verbal Reasoning</span>
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2">
                        <button id="font-decrease-button" class="font-size-button">A-</button>
                        <button id="font-increase-button" class="font-size-button">A+</button>
                    </div>
                    <div id="timer" class="text-base px-3 py-1 rounded-md">9:00</div>
                    <span class="text-sm">Question <span id="question-number-info">1</span> of 16</span>
                    <button id="flag-button" class="text-sm font-medium border border-white rounded px-2 py-1 transition-colors duration-150">
                         Flag for Review
                    </button>
                </div>
            </div>
            <div class="main-content-area">
                <div class="passage-column resizable-text">
                    <h3 class="text-lg font-semibold mb-2 sticky top-0 bg-white text-gray-900 pb-1">Passage <span id="passage-number">1</span></h3>
                    <div id="passage-text" class="text-base text-gray-900 leading-relaxed whitespace-pre-wrap"></div>
                </div>
                <div class="question-column resizable-text">
                     <h4 class="text-md font-semibold mb-3 sticky top-0 bg-white text-gray-900 pb-1">Question <span id="question-number">1</span></h4>
                    <p id="question-text" class="mb-4 text-gray-900"></p>
                    <div id="options-container" class="space-y-2"></div>
                    <div id="review-explanation-container"></div>
                </div>
            </div>
            <div class="footer-bar">
                <button id="back-to-results-button" class="hidden mr-auto">← Back to Results</button>
                <button id="end-exam-button-footer">End Exam</button>
                <div class="flex items-center space-x-2 ml-auto">
                    <button id="prev-button" disabled>← Previous (Alt+P)</button>
                    <button id="navigator-button">Navigator</button>
                    <button id="next-button">Next (Alt+N) →</button>
                </div>
            </div>
        </div>

        <div id="review-screen" class="hidden p-6 md:p-8 flex-col items-center h-full overflow-y-auto bg-gray-50">
             <div class="w-full max-w-3xl mb-4 flex justify-between items-center">
                 <h2 class="text-2xl font-bold text-gray-900">Review Your Answers</h2> <button id="filter-flagged-button" class="bg-white border border-gray-300 text-gray-700 px-3 py-1 rounded-md text-sm hover:bg-gray-100">Show Flagged Only</button>
            </div>
             <p class="text-center text-gray-600 mb-6">Click on a question number to review it. Green indicates answered, Yellow border indicates flagged.</p>
             <div id="review-grid" class="grid grid-cols-4 sm:grid-cols-5 md:grid-cols-6 lg:grid-cols-10 gap-3 mb-6 w-full max-w-3xl"></div>
            <div class="mt-auto pt-6">
                <button id="end-exam-button" class="bg-red-600 text-white hover:bg-red-700 text-lg px-8 py-3 rounded-md">
                    End Exam & See Results
                </button>
            </div>
        </div>


        <div id="results-screen" class="hidden p-4 md:p-8 flex-col h-full overflow-y-auto w-full">
            <div class="w-full max-w-4xl mx-auto">
                <div class="text-center mb-8">
                    <h2 class="text-3xl md:text-4xl font-bold text-gray-900">Exam Results</h2>
                    <p class="text-gray-600 mt-2">Here's a breakdown of your performance.</p>
                </div>

                <div class="card p-8 mb-8 text-center">
                    <p class="text-lg text-gray-600 mb-2">Your Score</p>
                    <p class="text-6xl font-bold text-gray-900"><span id="score">0</span><span class="text-4xl text-gray-500"> / <span id="total-questions-results">16</span></span></p>
                    <div class="mt-4 h-1 w-24 bg-indigo-200 mx-auto rounded-full"></div>
                    <p class="mt-4 text-md text-gray-500">Time Taken: <span id="time-taken" class="font-semibold"></span></p>
                </div>

                <div class="grid md:grid-cols-5 gap-8 mb-8">
                    <div class="md:col-span-2 space-y-8">
                        <div class="card p-6">
                            <h4 class="text-lg font-semibold mb-3 text-center text-gray-800">Time Analysis</h4>
                            <div id="time-analysis-results" class="space-y-2 text-sm text-gray-600"></div>
                        </div>
                        <div class="card p-6">
                            <h4 class="text-lg font-semibold mb-3 text-center text-gray-800">Performance by Type</h4>
                            <div id="type-analysis-results" class="space-y-2 text-sm text-gray-600"></div>
                        </div>
                    </div>
                    <div class="md:col-span-3 card p-6">
                         <h3 class="text-lg font-semibold mb-1 text-gray-800">Detailed Results</h3>
                         <p class="text-sm text-gray-500 mb-4">Click a box to review the question.</p>
                         <div id="results-grid-container"></div>
                    </div>
                </div>

                <div class="card p-8 mb-8">
                    <h3 class="text-xl font-semibold mb-6 text-gray-800">Reflection</h3>
                    <div class="space-y-6">
                        <div>
                            <label for="reflection-q1" class="block text-md font-semibold text-gray-700 mb-2">Which question type was most challenging, and why?</label>
                            <textarea id="reflection-q1" rows="3" class="themed-input block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm sm:text-sm" placeholder="e.g., Inference questions were tricky because..."></textarea>
                        </div>
                        <div>
                            <label for="reflection-q2" class="block text-md font-semibold text-gray-700 mb-2">Which question took you the longest, and why?</label>
                            <textarea id="reflection-q2" rows="3" class="themed-input block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm sm:text-sm" placeholder="e.g., Question 7 took a while because I had to re-read the passage..."></textarea>
                        </div>
                        <div>
                            <label for="reflection-q3" class="block text-md font-semibold text-gray-700 mb-2">Did you stick to your 'Practice Intention'? If not, what distracted you?</label>
                            <textarea id="reflection-q3" rows="3" class="themed-input block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm sm:text-sm" placeholder="I wanted to focus on speed, but got bogged down in the details..."></textarea>
                        </div>
                    </div>
                </div>

                <div class="text-center flex justify-center items-center space-x-4">
                    <button onclick="window.location.reload()" class="secondary-button-new">
                        Try Again
                    </button>
                    <button id="download-pdf-button" class="primary-button-new">
                        Download Results PDF
                    </button>
                </div>
            </div>
        </div>


        <div id="navigator-modal" class="modal">
            <div class="modal-content bg-white p-6 rounded-lg shadow-xl">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-semibold text-gray-900">Question Navigator</h3> <button id="close-modal-button" class="text-gray-500 hover:text-gray-700 text-2xl font-bold">&times;</button>
                </div>
                 <p class="text-sm text-gray-600 mb-4">Click a number to jump. Green: answered, Yellow border: flagged.</p>
                 <div id="navigator-grid" class="grid grid-cols-5 gap-3"></div>
            </div>
        </div>

    </div>

    <script>
        // --- Data & State ---
        const passages = [
            `In 2022 the Maritime Heritage Consortium (MHC) announced that it would return a cache of 15th-century bronze astrolabes to the coastal nation of Kalafi. The devices had been recovered in 1974 from a Portuguese caravel that sank offshore but had been displayed in European museums ever since. Kalafi's government hailed the move as the first major victory of its 2018 "Artifacts for Identity" campaign, which frames ocean-salvaged objects as extensions of submerged territorial sovereignty.\nNot everyone is convinced. Legal scholars point out that the United Nations Convention on the Law of the Sea (UNCLOS) treats wrecks more than one nautical mile below the surface as "international archaeological heritage," a status that weakens Kalafi's ownership claim because the caravel rests 1.6 miles down. The MHC sidestepped the question by citing its own ethical charter, updated last year to prioritise "provenance sensitivity" over jurisdictional clarity.\nMuseums, meanwhile, face practical dilemmas. The Rotterdam Navigational Gallery has agreed to transfer its two astrolabes but insists that Kalafi first lend the pieces back for a three-year touring exhibition on early cartography-an arrangement critics call "repatriation on a leash." Insurance brokers add another wrinkle: the artefacts were last valued in euros, yet Kalafi requires incoming cultural assets to be insured in its volatile local currency, a policy originally aimed at deterring illicit traders.\nBehind these technical arguments lies a more strategic calculus. Kalafi is negotiating deep-sea mining licences with European firms; diplomats privately suggest that gracious object returns could sweeten those talks. Whether the bronzes end up in Kalafi's new National Oceanic Museum or circulate once more through European vitrines may therefore depend less on moral clarity than on cobalt demand forecasts.`,
            `When advocates of "Pleistocene rewilding" propose releasing elephants or cheetahs onto the Great Plains of North America, ecologists like to point out that no ecosystem is a museum. The tall-grass prairie of today germinated under diesel combines and commodity prices, not Pleistocene rainfall. Yet the proposal keeps resurfacing, and not only because charismatic megafauna are good for fund-raising brochures. In its bolder formulations, rewilding is a critique of conservation's usual nostalgia: it asks whether restoring a landscape to the moment Europeans first mapped it is any more "authentic" than restoring it to ten-thousand years earlier-or ten thousand later.\nThe comforting notion that there once existed a single, authentic baseline is itself a historical fiction; ecosystems have never stopped rearranging themselves. Opponents counter that authenticity is the wrong metric; feasibility is. Every modern prairie town is threaded with highways, crop fields and barbed wire-features from which an elephant's roaming instinct will not politely recoil. Moreover, the very climate envelope that once sustained North American proboscideans is sliding pole-ward. Introducing heat-stressed herbivores just as forage becomes erratic, they say, is ecological malpractice disguised as audacity.\nProponents reply that managed experiments, not arm-chair vetoes, should arbitrate risks. After all, bison herds-once deemed incompatible with ranching-now co-exist (uneasily) with cattle operations, and carbon markets place a price on the prairie's root-bound soils. If climate volatility is inevitable, they argue, then large, mobile herbivores may buffer grasslands by preventing woody takeover and sequestering carbon in trampled litter. In their view, refusing to test such hypotheses because the optics unsettle us is itself a gamble-one that bets on passivity in a century of flux.`,
            `In 1976 the philosopher Thomas Nagel asked why moral judgment seems to track factors beyond an agent's control. He contrasted two careless drivers: one swerves, the other does not; only the latter strikes a pedestrian. Although their intentions are identical, we condemn the unlucky driver more harshly. Bernard Williams called this tension "moral luck," arguing that any ethics that ignores outcome feels air-tight yet inhuman, while any ethics that absorbs outcome risks undermining the idea of desert.\nLegal theorists have long lived inside the dilemma. Anglo-American tort law compensates victims according to harm done, not merely risk created; the reckless driver who misses pays nothing. Yet criminal law occasionally tilts the other way: attempted murder and completed murder can carry similar sentences, signalling that intent matters as much as result. Where the line is drawn often reflects pragmatic politics rather than tidy principle. California's "felony-murder rule," for instance, once imposed life sentences on getaway drivers whose partners killed during a robbery-until a 2018 reform limited liability to those who "acted with reckless indifference."\nCognitive scientists now complicate the debate. Experiments show that subjects asked to assign blame rely heavily on outcome when time is short, but weight intention more when given minutes to deliberate. Neuroscientists have traced the quick-outcome response to the amygdala, while slower intention weighting recruits prefrontal circuitry linked to counterfactual thinking. If moral intuition is partly a function of cognitive bandwidth, then the practical distinction between luck and responsibility may hinge on how much time society gives itself to judge.`,
            `Since 2017, dock-less electric scooters rented by smartphone app have appeared in more than 400 cities worldwide. Municipal transport offices like them in theory: each scooter produces roughly one-hundredth of the CO2 emitted by a small petrol car travelling the same distance. In practice, results vary widely. A 2023 study in Lyon found that, after eighteen months, 42 percent of scooter journeys replaced walks of under two kilometres, while only 12 percent replaced car trips; the remainder substituted bus or bicycle use.\nMaintenance and collection logistics complicate the emissions picture. Because most fleets rely on diesel vans to retrieve low-battery scooters each night, life-cycle assessments now treat a scooter's "green break-even point" as the moment when its cumulative CO2 savings outweigh the retrieval fleet's exhaust. For a model with a projected lifespan of three years, researchers in Portland calculated that break-even arrives after about 780 rider-kilometres-roughly four months of typical urban use-provided the scooter is not vandalised or dumped in a river first.\nSafety data are mixed. Hospital surveys in Brisbane recorded head injuries in one-third of scooter accidents, even though helmets are legally required. By contrast, Copenhagen's accident registry attributes only 6 percent of scooter crashes to head trauma; local officials credit lower road speeds and a network of segregated cycle lanes.\nThe industry's economic model remains uncertain. In 2024 one leading operator reported its first quarterly profit, citing a 15 percent fare rise and a shift to swappable batteries that riders insert themselves. Smaller firms, however, continue to exit markets where vandalism rates exceed 10 percent of fleet size per quarter.`
        ];
        const questions = [
            { passageIndex: 0, type: 'Inference', text: "Which motive for the MHC's decision is most strongly implied by the passage?", options: ["Fear of losing future salvage permits under UNCLOS revisions.", "Commitment to an ethics policy that now outweighs strict legal ownership.", "Pressure from insurance brokers over currency-conversion risks.", "Desire to secure exhibition loans from Kalafi for European museums."], correctAnswer: "B", explanation: "The passage states that the MHC 'sidestepped the question [of legal ownership] by citing its own ethical charter, updated last year to prioritise \"provenance sensitivity\" over jurisdictional clarity.' This shows their stated motive is their internal ethics policy." },
            { passageIndex: 0, type: 'Conclusion', text: "Based on the passage, the Rotterdam Navigational Gallery's proposal would most likely be viewed by critics as:", options: ["a necessary compromise to satisfy insurance regulations.", "an acknowledgment that Kalafi lacks facilities to preserve the bronzes.", "compliance with UNCLOS provisions on temporary custodianship.", "evidence that museums remain reluctant to relinquish control over artefacts."], correctAnswer: "D", explanation: "The passage notes that the arrangement where Kalafi must lend the astrolabes back for a three-year exhibition is one that 'critics call \"repatriation on a leash.\"' This phrase implies that the repatriation is not complete and that the museum is trying to maintain a degree of control." },
            { passageIndex: 0, type: 'Direct Retrieval', text: "The author suggests that safeguards can complicate restitution efforts by:", options: ["illustrating the diplomatic relationship between gracious object returns and deep-sea mining licences.", "highlighting the conflict between UNCLOS law and the MHC charter regarding international heritage below one nautical mile.", "highlighting the conflict involved in the currency exchange designed to deter illicit trading.", "emphasising The Rotterdam Navigational Gallery's hesitancy to return the astrolabes"], correctAnswer: "C", explanation: "The passage presents an insurance requirement as a 'wrinkle' that complicates matters. It states that Kalafi 'requires incoming cultural assets to be insured in its volatile local currency, a policy originally aimed at deterring illicit traders.' This insurance rule, a safeguard against illicit trade, creates a practical problem for the restitution." },
            { passageIndex: 0, type: 'Inference', text: "What inference can be drawn about Kalafi's negotiating strategy with European mining firms?", options: ["Kalafi views artefact repatriation as leverage to secure favourable mining terms.", "Kalafi intends to take strong action to limit mining firms' exploitation of its natural resources.", "Kalafi will waive its currency-insurance rule for museums that fund mining exploration.", "Kalafi's government believes the MHC charter is legally binding on private extractive companies."], correctAnswer: "A", explanation: "The author notes a 'strategic calculus' and that 'diplomats privately suggest that gracious object returns could sweeten those talks' regarding deep-sea mining licences. This implies that the goodwill from the artefact returns is seen as a bargaining chip in the mining negotiations." },
            { passageIndex: 1, type: 'Conclusion', text: "Which of the following best captures the author's attitude toward 'authenticity' as a goal for conservation?", options: ["It is indispensable because without it rewilding lacks direction.", "It is less important than practical outcomes when managing ecosystems.", "It is an unexamined assumption that rewilding provocatively challenges.", "It is the primary reason opponents reject the introduction of megafauna."], correctAnswer: "B", explanation: "The author presents the idea that a single 'authentic baseline is itself a historical fiction' and gives weight to the opponents' view that 'authenticity is the wrong metric; feasibility is.' The discussion then focuses on practical issues like highways, climate, and potential benefits, suggesting these are more important considerations." },
            { passageIndex: 1, type: 'Inference', text: "The opponents' reference to 'the very climate envelope ... sliding pole-ward' is meant to suggest that:", options: ["ancient climatic conditions can be recreated with sufficient management.", "rewilding should focus on species that tolerate cooler, wetter environments.", "future grassland climates will differ so much that historical analogies mislead.", "temperature shifts eliminate the need for herbivores to control woody plants."], correctAnswer: "C", explanation: "The 'climate envelope sliding pole-ward' means the historical climate that sustained these animals is changing and moving. Therefore, reintroducing them based on the assumption that the historical environment is still suitable is a flawed analogy, because the future climate will be different." },
            { passageIndex: 1, type: 'Direct Retrieval', text: "Using the passage, what do proponents believe regarding the benefits of large herbivores in a volatile climate?", options: ["That large herbivores will attract widespread attention and funding to helping the environment.", "A pilot study finds that tourist revenues triple in reserves containing megafauna.", "that large herbivores will help tree growth and thus minimise the impact of global warming.", "that large herbivores may improve grassland quality by combatting woodland dominance and capturing carbon."], correctAnswer: "D", explanation: "The passage explicitly states the proponents' argument: 'large, mobile herbivores may buffer grasslands by preventing woody takeover and sequestering carbon in trampled litter.' This directly matches option D." },
            { passageIndex: 1, type: 'Inference', text: "The author's comparison of bison herds with proposed elephant introductions serves primarily to:", options: ["illustrate that economic incentives can override ecological objections.", "demonstrate that past 'incompatible' species have been integrated after experimentation.", "imply that elephants would require less land than bison to thrive on the prairie.", "argue that ranchers are uniformly supportive of large-scale rewilding."], correctAnswer: "B", explanation: "The passage notes bison were 'once deemed incompatible with ranching' but now 'co-exist.' This is used as an example to support the proponents' call for 'managed experiments, not arm-chair vetoes,' suggesting that a species once considered unsuitable can be successfully integrated." },
            { passageIndex: 2, type: 'Conclusion', text: "The author presents the amygdala-prefrontal contrast chiefly to illustrate that:", options: ["blame judgments shift depending on cognitive resources available.", "neurological evidence has refuted the moral-luck debate.", "legal systems consistently mirror underlying brain architecture.", "counterfactual reasoning occurs only in artificially slow settings."], correctAnswer: "A", explanation: "The passage links the quick, outcome-based judgment to the amygdala and the slower, intention-based judgment to the prefrontal cortex, which is used when 'given minutes to deliberate.' This contrast directly illustrates that the type of moral judgment made can depend on the cognitive resources, like time, available for the decision." },
            { passageIndex: 2, type: 'Direct Retrieval', text: "Which passage detail best illustrates a partial retreat from strict outcome-based liability toward greater emphasis on an offender's mental state?", options: ["Tort law's rule that damages correspond to the actual harm a victim suffers", "The historical practice of sentencing getaway drivers to life if anyone is killed during a robbery", "California's 2018 amendment limiting felony-murder liability to participants who 'acted with reckless indifference'", "The parity of penalties sometimes imposed for attempted murder and completed murder"], correctAnswer: "C", explanation: "The passage explicitly describes California's 2018 reform, which changed the rule from a purely outcome-based one (a death occurred) to one that requires a specific mental state: 'reckless indifference.' This is a direct example of a retreat from strict outcome-based liability." },
            { passageIndex: 2, type: 'Conclusion', text: "What conclusion is most plausibly supported regarding ethical theory and real-world law?", options: ["Philosophical consistency is typically sacrificed when statutes confront political pressures.", "Legal codes have fully resolved the tension between risk and harm.", "Moral luck is irrelevant outside academic debate.", "Criminal law values outcomes more than intentions in all jurisdictions."], correctAnswer: "A", explanation: "The passage states, 'Where the line is drawn often reflects pragmatic politics rather than tidy principle.' This directly supports the conclusion that the clean, consistent lines of philosophical theory are often compromised by the practical and political realities of creating laws." },
            { passageIndex: 2, type: 'Inference', text: "Given the discussion, the author would most likely endorse which policy for improving jury deliberations?", options: ["Provide jurors with real-time neuroscans of defendants to detect intent.", "Extend mandatory deliberation periods to allow deeper consideration of mental states.", "Eliminate outcome information until after a verdict on intention is reached.", "Reduce sentencing ranges so that luck plays a minimal role in punishment severity."], correctAnswer: "B", explanation: "The passage concludes by suggesting the distinction between luck and responsibility might 'hinge on how much time society gives itself to judge.' It also states that people 'weight intention more when given minutes to deliberate.' Therefore, extending deliberation periods would allow for more use of the prefrontal circuitry associated with considering intent, which the passage presents as a more nuanced form of judgment." },
            { passageIndex: 3, type: 'True/False/CantTell', text: "Overall, electric-scooter trips in Lyon generated less carbon dioxide than the car journeys they replaced.", options: ["True", "False", "Can't Tell"], correctAnswer: "C", explanation: "The passage states only 12% of scooter trips in Lyon replaced car trips, while 42% replaced walking (a zero-emission activity). It also mentions the emissions from retrieval vans. However, it does not provide enough data to calculate the net carbon impact. We cannot determine if the savings from the 12% that replaced car trips were enough to offset the new emissions from the 42% that replaced walking and the other substitutions. Therefore, we can't tell." },
            { passageIndex: 3, type: 'True/False/CantTell', text: "Portland researchers assume that a scooter will operate for at least four months before it pays back its collection-van emissions.", options: ["True", "False", "Can't Tell"], correctAnswer: "A", explanation: "The passage states that in Portland, the 'green break-even point'—when the scooter's CO2 savings outweigh the retrieval fleet's exhaust—'arrives after about 780 rider-kilometres-roughly four months of typical urban use.' This means the scooter must operate for this duration to become carbon-neutral relative to its collection logistics. This statement is True." },
            { passageIndex: 3, type: 'True/False/CantTell', text: "Copenhagen has fewer scooter-related head injuries partly because riders travel more slowly there.", options: ["True", "False", "Can't Tell"], correctAnswer: "A", explanation: "The passage contrasts Brisbane's high rate of head injuries with Copenhagen's low rate. It explicitly states that in Copenhagen, 'local officials credit lower road speeds and a network of segregated cycle lanes' for the better safety record. Therefore, the statement is True." },
            { passageIndex: 3, type: 'True/False/CantTell', text: "Vandalism is the main reason most small scooter companies leave certain cities.", options: ["True", "False", "Can't Tell"], correctAnswer: "A", explanation: "The passage states that 'Smaller firms, however, continue to exit markets where vandalism rates exceed 10 percent of fleet size per quarter.' This directly presents high vandalism rates as the reason for these companies to leave, making the statement True." }
        ];

        let currentQuestionIndex = 0;
        let userAnswers = new Array(questions.length).fill(null);
        let timerInterval;
        let timeLeft = 9 * 60;
        let examStartTime;
        let examEndTime;
        let userName = '';
        let userGoal = '';
        let userFocusArea = '';
        let isReviewingFromResults = false;
        let questionStartTime = null;
        let questionTimes = new Array(questions.length).fill(0);
        let flaggedQuestions = new Array(questions.length).fill(false);
        let isFilteringFlagged = false;
        let currentlyDisplayedPassageIndex = -1;
        let currentFontSize = 1.0;

        // --- Elements & Functions ---
        const appContainer = document.getElementById('app-container');
        const setupScreen = document.getElementById('setup-screen');
        const examScreen = document.getElementById('exam-screen');
        const reviewScreen = document.getElementById('review-screen');
        const resultsScreen = document.getElementById('results-screen');
        const navigatorModal = document.getElementById('navigator-modal');
        const startButton = document.getElementById('start-button');
        const prevButton = document.getElementById('prev-button');
        const nextButton = document.getElementById('next-button');
        const navigatorButton = document.getElementById('navigator-button');
        const closeModalButton = document.getElementById('close-modal-button');
        const endExamButton = document.getElementById('end-exam-button');
        const endExamButtonFooter = document.getElementById('end-exam-button-footer');
        const backToResultsButton = document.getElementById('back-to-results-button');
        const flagButton = document.getElementById('flag-button');
        const passageNumberEl = document.getElementById('passage-number');
        const passageTextEl = document.getElementById('passage-text');
        const questionNumberEl = document.getElementById('question-number');
        const questionNumberInfoEl = document.getElementById('question-number-info');
        const questionTextEl = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const timerEl = document.getElementById('timer');
        const reviewGrid = document.getElementById('review-grid');
        const navigatorGrid = document.getElementById('navigator-grid');
        const scoreEl = document.getElementById('score');
        const totalQuestionsResultsEl = document.getElementById('total-questions-results');
        const timeTakenEl = document.getElementById('time-taken');
        const resultsGridContainer = document.getElementById('results-grid-container');
        const nameInput = document.getElementById('name');
        const goalInput = document.getElementById('goal');
        const focusAreaInput = document.getElementById('focus-area');
        const examTitleEl = document.getElementById('exam-title');
        const filterFlaggedButton = document.getElementById('filter-flagged-button');
        const setupQuestionCountEl = document.getElementById('setup-question-count');
        const setupTimeLimitEl = document.getElementById('setup-time-limit');
        const reviewExplanationContainer = document.getElementById('review-explanation-container');
        const downloadPdfButton = document.getElementById('download-pdf-button');
        const fontDecreaseButton = document.getElementById('font-decrease-button');
        const fontIncreaseButton = document.getElementById('font-increase-button');
        const resizableTextElements = document.querySelectorAll('.resizable-text');
        const timeAnalysisResultsEl = document.getElementById('time-analysis-results');
        const typeAnalysisResultsEl = document.getElementById('type-analysis-results');

        function startTimer() { examStartTime = new Date(); clearInterval(timerInterval); timerEl.textContent = formatTimeSeconds(timeLeft); timerInterval = setInterval(() => { timeLeft--; timerEl.textContent = formatTimeSeconds(timeLeft); if (timeLeft <= 0) { endExamAndShowResults(); } }, 1000); }
        function stopTimer() { clearInterval(timerInterval); examEndTime = examEndTime || new Date(); }
        function formatTimeSeconds(totalSeconds) { if (totalSeconds < 0) totalSeconds = 0; const minutes = Math.floor(totalSeconds / 60); const seconds = totalSeconds % 60; return `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`; }
        function formatTimeMilliseconds(milliseconds) { if (!milliseconds || milliseconds < 0) return "0s"; return `${(milliseconds / 1000).toFixed(1)}s`; }
        function formatTimeDifference(milliseconds) { if (!milliseconds || milliseconds < 0) return "0 min 00 sec"; const totalSeconds = Math.round(milliseconds / 1000); const minutes = Math.floor(totalSeconds / 60); const seconds = totalSeconds % 60; return `${minutes} min ${seconds < 10 ? '0' : ''}${seconds} sec`; }
        function recordTimeSpent(index) { if (questionStartTime && index >= 0 && index < questions.length) { questionTimes[index] = (questionTimes[index] || 0) + (Date.now() - questionStartTime); } questionStartTime = null; }
        function toggleFlag() { if (isReviewingFromResults) return; flaggedQuestions[currentQuestionIndex] = !flaggedQuestions[currentQuestionIndex]; updateFlagButtonAppearance(); updateNavigatorButtons(); }
        function updateFlagButtonAppearance() { const isFlagged = flaggedQuestions[currentQuestionIndex]; flagButton.textContent = isFlagged ? 'Unflag' : 'Flag for Review'; flagButton.classList.toggle('flagged', isFlagged); }
        function updateFontSize() { resizableTextElements.forEach(el => { el.querySelectorAll('#passage-text, #question-text, .option-label').forEach(child => { child.style.fontSize = `${currentFontSize}rem`; }); }); }
        function loadQuestion(index, reviewMode = false) { if (index < 0 || index >= questions.length) return; if (!isReviewingFromResults && !reviewMode) { recordTimeSpent(currentQuestionIndex); } const question = questions[index]; const newPassageIndex = question.passageIndex; if (newPassageIndex !== currentlyDisplayedPassageIndex || reviewMode) { passageTextEl.innerHTML = passages[newPassageIndex].replace(/\n/g, '<br><br>'); passageNumberEl.textContent = newPassageIndex + 1; currentlyDisplayedPassageIndex = newPassageIndex; document.querySelector('.passage-column').scrollTop = 0; } currentQuestionIndex = index; isReviewingFromResults = reviewMode; questionNumberEl.textContent = index + 1; questionNumberInfoEl.textContent = `${index + 1} of ${questions.length}`; questionTextEl.textContent = question.text; document.querySelector('.question-column').scrollTop = 0; optionsContainer.innerHTML = ''; reviewExplanationContainer.innerHTML = ''; const optionLetters = question.options.length === 3 ? ['A', 'B', 'C'] : ['A', 'B', 'C', 'D']; question.options.forEach((option, i) => { const optionId = `q${index}_opt${i}`; const label = document.createElement('label'); label.htmlFor = optionId; label.className = 'option-label'; label.dataset.optionIndex = i; const radio = document.createElement('input'); radio.type = 'radio'; radio.id = optionId; radio.name = `question_${index}`; radio.value = optionLetters[i]; radio.disabled = reviewMode; label.style.cursor = reviewMode ? 'default' : 'pointer'; if (userAnswers[index] === optionLetters[i]) { radio.checked = true; label.classList.add('selected-answer'); } if (reviewMode) { const isCorrectAnswer = question.correctAnswer === optionLetters[i]; const isSelectedAnswer = userAnswers[index] === optionLetters[i]; if (isCorrectAnswer) { label.classList.add('border-green-500', 'border-2', 'bg-green-50'); } else if (isSelectedAnswer) { label.classList.add('border-red-500', 'border-2', 'bg-red-50'); } } label.appendChild(radio); label.appendChild(document.createTextNode(question.type === 'True/False/CantTell' ? ` ${option}` : ` ${optionLetters[i]}) ${option}`)); if (!reviewMode) { label.addEventListener('click', () => handleOptionSelect(index, i, optionLetters[i])); radio.addEventListener('change', () => handleOptionSelect(index, i, optionLetters[i])); } optionsContainer.appendChild(label); }); if (reviewMode && question.explanation) { const explanationDiv = document.createElement('div'); explanationDiv.className = 'explanation-box'; explanationDiv.innerHTML = `<strong class="font-semibold">Explanation:</strong><br>${question.explanation.replace(/\n/g, '<br>')}`; reviewExplanationContainer.appendChild(explanationDiv); } prevButton.disabled = index === 0; nextButton.textContent = (!reviewMode && index === questions.length - 1) ? 'Finish & Review' : 'Next (Alt+N) →'; if(reviewMode) nextButton.disabled = index === questions.length - 1; updateFlagButtonAppearance(); backToResultsButton.classList.toggle('hidden', !reviewMode); endExamButtonFooter.classList.toggle('hidden', reviewMode); examTitleEl.textContent = reviewMode ? "Reviewing Question" : "Verbal Reasoning"; flagButton.disabled = reviewMode; updateNavigatorHighlight(); updateFontSize(); if (!isReviewingFromResults) { questionStartTime = Date.now(); } }
        function handleOptionSelect(questionIndex, optionIndex, optionValue) { if (questionIndex !== currentQuestionIndex || isReviewingFromResults) return; userAnswers[questionIndex] = optionValue; document.querySelectorAll(`#options-container .option-label`).forEach(lbl => lbl.classList.remove('selected-answer')); const selectedLabel = document.querySelector(`#options-container label[for="q${questionIndex}_opt${optionIndex}"]`); if (selectedLabel) { selectedLabel.classList.add('selected-answer'); selectedLabel.querySelector('input[type="radio"]').checked = true; } updateNavigatorButtons(); }
        function showNextQuestion() { const reviewMode = isReviewingFromResults; const nextIndex = currentQuestionIndex + 1; if (nextIndex < questions.length) { loadQuestion(nextIndex, reviewMode); } else if (!reviewMode) { recordTimeSpent(currentQuestionIndex); stopTimer(); showReviewScreen(); } }
        function showPrevQuestion() { if (currentQuestionIndex > 0) { loadQuestion(currentQuestionIndex - 1, isReviewingFromResults); } }
        function showScreen(screenToShow) { [setupScreen, examScreen, reviewScreen, resultsScreen].forEach(screen => { screen.classList.add('hidden'); screen.classList.remove('flex'); }); screenToShow.classList.remove('hidden'); if (screenToShow !== examScreen) appContainer.classList.remove('!border-none', '!shadow-none', '!m-0', '!rounded-none'); else appContainer.classList.add('!border-none', '!shadow-none', '!m-0', '!rounded-none'); if (screenToShow === setupScreen || screenToShow === resultsScreen) { screenToShow.classList.add('flex'); } }
        function showReviewScreen(filterFlagged = false) { recordTimeSpent(currentQuestionIndex); stopTimer(); showScreen(reviewScreen); reviewScreen.classList.add('flex'); reviewGrid.innerHTML = ''; questions.forEach((_, index) => { if (filterFlagged && !flaggedQuestions[index]) return; const button = document.createElement('button'); button.textContent = index + 1; button.className = 'review-grid-button'; button.classList.toggle('review-grid-button-answered', userAnswers[index] !== null); button.classList.toggle('review-grid-button-unanswered', userAnswers[index] === null); if (flaggedQuestions[index]) button.classList.add('review-flagged'); button.onclick = () => { showScreen(examScreen); examScreen.classList.add('flex'); loadQuestion(index); startTimer(); }; reviewGrid.appendChild(button); }); filterFlaggedButton.textContent = filterFlagged ? 'Show All Questions' : 'Show Flagged Only'; }
        function populateNavigator() { navigatorGrid.innerHTML = ''; questions.forEach((_, index) => { const button = document.createElement('button'); button.textContent = index + 1; button.className = 'py-2 px-1 border border-gray-300 rounded-md text-center transition duration-150 ease-in-out text-sm hover:bg-gray-100'; button.dataset.questionIndex = index; if (userAnswers[index]) button.classList.add('nav-answered'); if (index === currentQuestionIndex) button.classList.add('nav-current'); if (flaggedQuestions[index]) button.classList.add('nav-flagged'); button.onclick = () => { navigatorModal.classList.remove('flex'); loadQuestion(parseInt(button.dataset.questionIndex, 10), isReviewingFromResults); if (!isReviewingFromResults) questionStartTime = Date.now(); }; navigatorGrid.appendChild(button); }); }
        function updateNavigatorButtons() { navigatorGrid.querySelectorAll('button').forEach(button => { const index = parseInt(button.dataset.questionIndex, 10); button.classList.toggle('nav-answered', !!userAnswers[index]); button.classList.toggle('nav-current', index === currentQuestionIndex); button.classList.toggle('nav-flagged', flaggedQuestions[index]); }); }
        function updateNavigatorHighlight() { navigatorGrid.querySelectorAll('button').forEach(button => { button.classList.toggle('nav-current', parseInt(button.dataset.questionIndex, 10) === currentQuestionIndex); }); }
        function analyzeAndDisplayPerformance() { let correctTimeTotal = 0, correctCount = 0, incorrectTimeTotal = 0, incorrectCount = 0; const typeStats = {}; questions.forEach((q, i) => { const isCorrect = userAnswers[i] === q.correctAnswer; if (userAnswers[i] !== null) { (isCorrect ? (correctTimeTotal += questionTimes[i], correctCount++) : (incorrectTimeTotal += questionTimes[i], incorrectCount++)); } const qType = q.type || 'Uncategorized'; if (!typeStats[qType]) typeStats[qType] = { correct: 0, total: 0 }; typeStats[qType].total++; if(isCorrect) typeStats[qType].correct++; }); timeAnalysisResultsEl.innerHTML = `<p class="flex justify-between"><span>Avg. time (Correct):</span> <span class="font-bold text-green-600">${correctCount > 0 ? formatTimeMilliseconds(correctTimeTotal / correctCount) : 'N/A'}</span></p><p class="flex justify-between"><span>Avg. time (Incorrect):</span> <span class="font-bold text-red-600">${incorrectCount > 0 ? formatTimeMilliseconds(incorrectTimeTotal / incorrectCount) : 'N/A'}</span></p>`; typeAnalysisResultsEl.innerHTML = ''; Object.keys(typeStats).sort().forEach(type => { const stats = typeStats[type]; const percentage = stats.total > 0 ? Math.round((stats.correct / stats.total) * 100) : 0; typeAnalysisResultsEl.innerHTML += `<p class="flex justify-between"><span>${type}:</span> <span class="font-bold">${stats.correct}/${stats.total} (${percentage}%)</span></p>`; }); }
        function showResultsScreen() { examEndTime = examEndTime || new Date(); recordTimeSpent(currentQuestionIndex); stopTimer(); showScreen(resultsScreen); let score = 0; resultsGridContainer.innerHTML = ''; questions.forEach((qData, index) => { const isCorrect = userAnswers[index] === qData.correctAnswer; if (isCorrect) score++; const container = document.createElement('div'); const resultBox = document.createElement('div'); resultBox.className = 'result-box'; resultBox.classList.add(isCorrect ? 'result-box-correct' : 'result-box-incorrect'); if (flaggedQuestions[index]) resultBox.classList.add('result-box-flagged'); resultBox.title = `Click to review Question ${index + 1}`; const timeDiv = document.createElement('div'); timeDiv.className = 'time-spent'; timeDiv.textContent = `${Math.round((questionTimes[index] || 0) / 1000)}s`; resultBox.appendChild(timeDiv); container.appendChild(resultBox); const qNumDiv = document.createElement('div'); qNumDiv.className = 'question-num-label'; qNumDiv.textContent = `Q${index + 1}`; container.appendChild(qNumDiv); container.addEventListener('click', () => revisitQuestionFromResults(index)); resultsGridContainer.appendChild(container); }); scoreEl.textContent = score; totalQuestionsResultsEl.textContent = questions.length; timeTakenEl.textContent = formatTimeDifference(examEndTime - examStartTime); analyzeAndDisplayPerformance(); }
        function revisitQuestionFromResults(index) { showScreen(examScreen); examScreen.classList.add('flex'); loadQuestion(index, true); }
        function endExamAndShowResults() { stopTimer(); showResultsScreen(); }
        function generatePDF() { const { jsPDF } = window.jspdf; const doc = new jsPDF(); let y = 15; const lineHeight = 7; const margin = 15; const pageWidth = doc.internal.pageSize.width; doc.setFontSize(18); doc.text("UCAT Verbal Reasoning Results", pageWidth / 2, y, { align: 'center' }); y += lineHeight * 2; doc.setFontSize(12); const summaryData = [ ["Name:", userName || 'N/A'], ["Goal:", `${userGoal || 'N/A'} / ${questions.length}`], ["Focus Area:", userFocusArea || 'N/A'], ["Final Score:", `${scoreEl.textContent} / ${questions.length}`], ["Time Taken:", timeTakenEl.textContent] ]; summaryData.forEach(row => { doc.setFont(undefined, 'bold'); doc.text(row[0], margin, y); doc.setFont(undefined, 'normal'); doc.text(row[1], margin + 40, y); y += lineHeight; }); y += lineHeight; doc.save(`ucat_vr_results_${userName.replace(/\s+/g, '_') || 'user'}.pdf`); }
        
        // --- Event Listeners ---
        startButton.addEventListener('click', () => { userName = nameInput.value.trim(); userGoal = goalInput.value.trim(); userFocusArea = focusAreaInput.value.trim(); timeLeft = 9 * 60; showScreen(examScreen); examScreen.classList.add('flex'); startTimer(); loadQuestion(0); populateNavigator(); });
        nextButton.addEventListener('click', showNextQuestion);
        prevButton.addEventListener('click', showPrevQuestion);
        endExamButton.addEventListener('click', endExamAndShowResults);
        endExamButtonFooter.addEventListener('click', () => { recordTimeSpent(currentQuestionIndex); stopTimer(); showReviewScreen(); });
        backToResultsButton.addEventListener('click', () => { isReviewingFromResults = false; showResultsScreen(); });
        navigatorButton.addEventListener('click', () => { recordTimeSpent(currentQuestionIndex); updateNavigatorButtons(); navigatorModal.classList.add('flex'); });
        closeModalButton.addEventListener('click', () => { navigatorModal.classList.remove('flex'); if (!isReviewingFromResults) questionStartTime = Date.now(); });
        navigatorModal.addEventListener('click', (event) => { if (event.target === navigatorModal) closeModalButton.click(); });
        flagButton.addEventListener('click', toggleFlag);
        filterFlaggedButton.addEventListener('click', () => { isFilteringFlagged = !isFilteringFlagged; showReviewScreen(isFilteringFlagged); });
        downloadPdfButton.addEventListener('click', generatePDF);
        fontIncreaseButton.addEventListener('click', () => { if(currentFontSize < 1.5) { currentFontSize += 0.1; updateFontSize(); } });
        fontDecreaseButton.addEventListener('click', () => { if (currentFontSize > 0.8) { currentFontSize -= 0.1; updateFontSize(); } });

        document.addEventListener('keydown', (e) => {
             const isExamVisible = !examScreen.classList.contains('hidden');
             const isModalVisible = navigatorModal.classList.contains('flex');
             const isInputFocused = document.activeElement && (document.activeElement.tagName === 'INPUT' || document.activeElement.tagName === 'TEXTAREA');
             if (isModalVisible || isInputFocused || !isExamVisible) return;
             if (e.altKey) {
                 if (e.code.toLowerCase() === 'keyn') { e.preventDefault(); if (!nextButton.disabled) nextButton.click(); }
                 if (e.code.toLowerCase() === 'keyp') { e.preventDefault(); if (!prevButton.disabled) prevButton.click(); }
                 if (e.code.toLowerCase() === 'keyf') { e.preventDefault(); if (!isReviewingFromResults && !flagButton.disabled) flagButton.click(); }
             } else if (['a', 'b', 'c', 'd'].includes(e.key.toLowerCase()) && !isReviewingFromResults) {
                 e.preventDefault();
                 const optionIndex = ['a', 'b', 'c', 'd'].indexOf(e.key.toLowerCase());
                 if (optionIndex < questions[currentQuestionIndex].options.length) {
                     handleOptionSelect(currentQuestionIndex, optionIndex, ['A', 'B', 'C', 'D'][optionIndex]);
                 }
             }
        });

        // --- Initial Load ---
        showScreen(setupScreen);
        updateFontSize();

    </script>
</body>
</html>
```
